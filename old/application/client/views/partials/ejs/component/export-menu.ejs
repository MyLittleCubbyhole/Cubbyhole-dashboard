<section id="box-export" ng-show="Dashboard.exportModalVisible" ng-cloak modal>
	<section class="widget-content export-content" flip ng-class="{rotated: _flip._active}">
		<section ng-controller="ExportController">
			<section class="widget-side widget-frontside">
				<section class="export-head">CHOOSE YOUR EXPORT METHOD</section>
				<i class="close-icon icon-cross" ng-click="Dashboard.exportModalLocked || _modal.close();"></i>
				<section id="logo-bouncing"><img src="/images/design/snuffen.png" alt="logo"></section>
				<section class="export-container">
					<article class="export export-pdf" ng-click="Dashboard.exportModalLocked || _flip.active() && Dashboard.exportModalLocked || Export.capture();">
						<span class="export-text">PDF</span>
					</article>
					<article class="export export-xml" ng-click="Dashboard.exportModalLocked || _flip.active() && Dashboard.exportModalLocked || Export.showExportDetails('xml')">
						<span class="export-text">XML</span>
					</article>
					<article class="export export-csv" ng-click="Dashboard.exportModalLocked || _flip.active() && Dashboard.exportModalLocked || Export.showExportDetails('csv')">
						<span class="export-text">CSV</span>
					</article>
				</section>
			</section>
			<section class="widget-side widget-backside loader" ng-show="Export.inProgress">
			</section>
            <section class="widget-side widget-backside" ng-if="!Export.inProgress">
				<section class="export-container-details">
					<article class="widget-back-head">
						<nav class="nav-pills">
							<article ng-click="_flip.active();" class="pill back">
								<i class="icon-back"></i><span class="pill-name"></span>
							</article>
							<article ng-click="Export.tab = 'data'" ng-class="{active: Export.tab == 'data'}" class="pill">
								<i class="icon-earth"></i><span class="pill-name">DATA</span>
							</article>
							<article ng-click="Export.tab = 'filters'" ng-class="{active: Export.tab == 'filters'}" class="pill">
								<i class="icon-filter"></i><span class="pill-name">FILTERS</span>
							</article>
						</nav>
						<article class="corner-text-save" ng-click="Export.save();">EXPORT</article>
					</article>
					<article class="widget-back-body">
						<section id="widget-back-switch" ng-switch on="Export.tab">
							<article class="widget-back-tab nodrag" ng-switch-when="data" scroll-bar>
								<section class="bloc-tab">
									<article class="bloc-title">Data</article>
									<article class="bloc-content">
										<article class="bloc-content-option" ng-repeat="(indexKpi, selectedKpi) in Export.selectedKpis track by $index" ng-class="{ disabled: !selectedKpi.kpi }">
											<span ng-if="!selectedKpi.kpi" ng-click="Export.addKpi(indexKpi);">&nbsp</span>
											<span grumpy-ui grumpy-position="right" grumpy-align="top" ng-if="!!selectedKpi.kpi" ng-class="{'no-close': $index == 0}">
												<span>{{selectedKpi.kpi.formattedAlias}}<i class="icon-cross" ng-click="Export.removeKpi(indexKpi)" ng-if="$index > 0"></i></span>
												<grumpy-virgin class="bounceIn">
													<section class="filter-kpi-box" scroll-bar>
														<section ng-repeat="(category, kpis) in Export.kpis track by $index" ng-init="kpistatus = false">
															<article class="kpi-category" ng-click="kpistatus = !kpistatus">{{category}}</article>
															<section class="kpi-list" ng-class="{ open: kpistatus}">
																<article ng-repeat="kpi in kpis track by $index" class="kpi" ng-click="Export.changeKpi(indexKpi, kpi); _grumpyUi.close();" ng-class="{ active: kpi.index == selectedKpi.kpi }">
																	{{kpi.formattedAlias}}
																</article>
															</section>
														</section>
													</section>
												</grumpy-virgin>
											</span>
										</article>
									</article>
								</section>
							</article>
							<article class="widget-back-tab widget-back-tab-filters nodrag" ng-switch-when="filters">
								<article class="bloc-panel">
									<article class="filter-select" ng-class="{'filter-select-active': Export.currentFilter == $index}" ng-repeat="filter in Export.filters track by $index" ng-click="Export.currentFilter = $index">
										<article class="filter-number">{{$index + 1}}</article>
										<article class="del-btn" ng-if="$index > 0" ng-click="Export.removeFilter($index)"><i class="icon-cross"></i></article>
									</article>
									<article class="filter-select" ng-if="Export.filters.length < 2" ng-click="Export.filters.push({operator: 'AND', name: 'Filter ' + (Export.filters.length + 1)})">
										<article class="filter-number">+</article>
									</article>
								</article>
								<section class="bloc-tab-container">
									<section class="bloc-tab bloc-tab-filter" scroll-bar>
										<article class="bloc-title">
											<input type="text" ng-model="Export.filters[Export.currentFilter].name" />
											<label class="toggle float-right">
												<input type="checkbox" name="checkbox-toggle" ng-change="Export.filters[Export.currentFilter].operator = Export.filters[Export.currentFilter].operator == 'AND' ? 'OR' : 'AND';" ng-checked="Export.filters[Export.currentFilter].operator == 'OR'" ng-model="operator">
												<i data-swchon-text="OR" data-swchoff-text="AND"></i>
											</label>
										</article>
										<article class="bloc-content">
											<article class="bloc-content-option filter" ng-repeat="(filterIndex, filter) in Export.filters[Export.currentFilter].conditions track by $index">
												<span grumpy-ui grumpy-position="bottom" grumpy-align="left">
													{{filter.kpi.formattedAlias}}
													<grumpy-virgin class="bounceIn">
														<section class="filter-kpi-box" scroll-bar>
															<section ng-repeat="(category, kpis) in Export.kpis track by $index" ng-init="kpistatus = false">
																<article class="kpi-category" ng-click="kpistatus = !kpistatus">{{category}}</article>
																<section class="kpi-list" ng-class="{ open: kpistatus}">
																	<article ng-repeat="kpi in kpis track by $index" class="kpi" ng-click="filter.kpi = kpi; Export.transformDateValues(filterIndex, kpi); _grumpyUi.close();" ng-class="{ active: kpi.index == filter.kpi.index }">
																		{{kpi.formattedAlias}}
																	</article>
																</section>
															</section>
														</section>
													</grumpy-virgin>
												</span>
												<span grumpy-ui grumpy-position="bottom" grumpy-align="center">
													{{Export.operatorsName[filter.operator]}}
													<grumpy-virgin class="bounceIn">
														<section  class="filter-kpi-box operators" scroll-bar>
															<article class="operator-row" ng-repeat="(index, operator) in Export.operators track by $index" ng-class="{ active: index == filter.operator }" ng-init="inflection = false">
																<article class="kpi-category" >
																	<article class="operator-title" ng-click="filter.operator = operator.op; _grumpyUi.close();">
																		{{operator.name}}
																	</article>
																	<i class="open-sub-dir icon-arrow-down" ng-class="{ 'icon-arrow-up': inflection, 'icon-arrow-down': !inflection }" ng-click="inflection = !inflection"></i>
																</article>
																<section class="kpi-list" ng-class="{ open: inflection}">
																	<article ng-repeat="inflection in operator.inflections track by $index" class="kpi" ng-click="filter.operator = inflection.op; _grumpyUi.close();" ng-class="{ active: inflection.op == filter.operator }">
																		{{inflection.name}}
																	</article>
																</section>

															</article>
														</section>
													</grumpy-virgin>
												</span>

												<span grumpy-ui grumpy-position="bottom" grumpy-align="right">
												    <span ng-if="filter.operator == 'BETWEEN' || filter.operator == 'NOT BETWEEN'">{{filter.value[0] == '' && filter.value[1] == '' ? 'VALUE' : Export.getValueToShow(filterIndex, 0) + ' AND ' + Export.getValueToShow(filterIndex, 1)}}</span>
												    <span ng-if="filter.operator == 'IN' || filter.operator == 'NOT IN'">{{filter.value[0] == '' && filter.value[1] == '' ? 'VALUE' : 'ARRAY'}}</span>
												    <span ng-if="filter.operator != 'BETWEEN' && filter.operator != 'NOT BETWEEN' && filter.operator != 'IN' && filter.operator != 'NOT IN'">{{ typeof(filter.value[0]) != 'undefined' && filter.value[0] != '' ? Export.getValueToShow(filterIndex, 0) : 'VALUE' }}</span>
												    <grumpy-virgin class="bounceIn">
												        <section class="filter-value-box">
												            <section class="input-boxes" scroll-bar>
												                <article class="values-in" ng-class="{'input-date': filter.kpi.format == 'date'}" ng-repeat="(valueIndex, value) in filter.value track by $index" ng-if="((filter.operator == 'BETWEEN' || filter.operator == 'NOT BETWEEN') && valueIndex < 5) || (filter.operator != 'BETWEEN' && filter.operator != 'NOT BETWEEN' && filter.operator != 'IN' && filter.operator != 'NOT IN' && valueIndex < 1) || filter.operator == 'IN' || filter.operator == 'NOT IN'">
												                    <article class="separator">
												                        <span ng-if="(filter.operator == 'BETWEEN' || filter.operator == 'NOT BETWEEN') && valueIndex == 1">AND</span>
												                    </article>
												                    <input type="text" placeholder="value" ng-class="{'input-date': filter.kpi.format != 'date'}" ng-model="filter.value[valueIndex]" ng-if="!filter.value[valueIndex].name && filter.kpi.format != 'date'">
												                    <input type="text" placeholder="value" date-picker ng-class="{'input-date': filter.kpi.format == 'date'}" ng-model="filter.value[valueIndex]" ng-if="!filter.value[valueIndex].name && filter.kpi.format == 'date'">
												                    <input type="text" placeholder="value" ng-class="{'input-date': filter.kpi.format == 'date'}" ng-disabled="filter.value[valueIndex].name" value="{{Export.getValueToShow(filterIndex, valueIndex)}}" ng-if="filter.value[valueIndex].name">
												                    <article class="del-btn" ng-click="filter.value.splice(valueIndex, 1);" ng-if="valueIndex > 1"><i class="icon-cross"></i></article>
												                        <article class="cal-btn" ng-class="{'cal-btn-only': valueIndex < 2, 'cal-btn-between': (filter.operator == 'BETWEEN' || filter.operator == 'NOT BETWEEN') && valueIndex == 1}" ng-if="filter.kpi.format == 'date'" grumpy-ui grumpy-position="right" grumpy-align="center">
												                            <i class="icon-calendar"></i>
												                            <grumpy-virgin class="bounceIn">
												                                <section class="calendar-relative-picker">
												                                    <article class="btn cubby-btn button-calendar" ng-class="{active: filter.value[valueIndex].name}" ng-click="Export.switchDateNow(filterIndex, valueIndex)">NOW</article>
												                                    <article class="btn cubby-btn button-calendar" ng-class="{disabled: !filter.value[valueIndex].name || filter.value[valueIndex].name == '', active: filter.value[valueIndex].apply == 'SUB'}" ng-click="Export.switchDateAdd(filterIndex, valueIndex, 'SUB')">SUB</article>
												                                    <article class="btn cubby-btn button-calendar" ng-class="{disabled: !filter.value[valueIndex].name || filter.value[valueIndex].name == '', active: filter.value[valueIndex].apply == 'ADD'}" ng-click="Export.switchDateAdd(filterIndex, valueIndex, 'ADD')">ADD</article>
												                                    <input type="text" placeholder="value" ng-model="value.value" ng-disabled="!filter.value[valueIndex].apply">
												                                </section>
												                            </grumpy-virgin>
												                        </article>
												                </article>
												            </section>
												            <article class="btn cubby-btn button-add" ng-click="filter.value.push('')" ng-if="(filter.operator == 'IN' || filter.operator == 'NOT IN')">ADD</article>
												        </section>
												    </grumpy-virgin>
												</span>
												<article class="del-btn" ng-click="Export.filters[Export.currentFilter].conditions.splice($index, 1);"><i class="icon-cross"></i></article>
											</article>
										</article>
									</section>
									<section class="bloc-tab bloc-tab-filter">
										<article class="add-filter btn cubby-btn" ng-click="Export.addCondition(Export.currentFilter);">ADD</article>
									</section>
								</section>
							</article>
						</section>
					</article>
				</section>
			</section>
			<form-post-downloader></form-post-downloader>
		</section>
	</section>
</section>